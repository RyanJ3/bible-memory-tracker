<!-- flow-memorization.component.html -->
<div class="p-6 max-w-4xl mx-auto bg-gray-50 rounded-lg shadow">
  <h1 class="text-3xl font-bold mb-6 text-center text-blue-700">FLOW Memorization Helper</h1>
  <p class="mb-4 text-center">
    Reduce scripture text to First Letter Of Words (FLOW) format for memorization practice.
  </p>

  <div class="mb-6">
    <div class="grid md:grid-cols-2 gap-4 mb-4">
      <div>
        <label class="block mb-2 font-medium">Book Title:</label>
        <input
          type="text"
          [(ngModel)]="bookTitle"
          placeholder="e.g., Psalms, John, Matthew"
          class="w-full p-2 border rounded"
        />
      </div>

      <div>
        <label class="block mb-2 font-medium">Chapter:</label>
        <input
          type="text"
          [(ngModel)]="chapter"
          placeholder="e.g., 1, 3, 5-7"
          class="w-full p-2 border rounded"
        />
      </div>
    </div>

    <div class="grid md:grid-cols-2 gap-4">
      <div>
        <label class="block mb-2 font-medium">Original Text:</label>
        <textarea
          [(ngModel)]="input"
          placeholder="Paste or type your Bible passage here... (Include verse numbers)"
          class="w-full h-64 p-4 border rounded focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        ></textarea>
      </div>

      <div>
        <label class="block mb-2 font-medium">Reduced Text:</label>
        <textarea
          [(ngModel)]="output"
          readonly
          placeholder="Reduced text will appear here after formatting..."
          class="w-full h-64 p-4 border rounded bg-gray-50"
        ></textarea>
      </div>
    </div>
  </div>

  <div class="flex justify-center space-x-4 mb-6">
    <button
      (click)="handleFormat()"
      [disabled]="isLoading || !input.trim()"
      class="px-4 py-2 rounded font-medium"
      [ngClass]="{'bg-green-500 hover:bg-green-600 text-white': !isLoading, 'bg-gray-300 text-gray-500': isLoading || !input.trim()}"
    >
      {{isLoading ? 'Processing...' : 'Reduce Text'}}
    </button>
  </div>

  <div *ngIf="isProcessed" class="mt-6">
    <h3 class="text-xl font-semibold mb-2">Transposed Reduced Text:</h3>
    <p class="mb-2 text-sm">Copy this grid and paste directly into Excel (Ctrl+C, then Ctrl+V in Excel)</p>
    <div class="overflow-x-auto bg-white border rounded p-4">
      <table class="min-w-full table-fixed border-collapse">
        <ng-container *ngFor="let chunk of getVerseChunks(); let chunkIndex = index">
          <thead>
          <tr>
            <th
              *ngFor="let verse of chunk; let index = index"
              class="px-2 py-1 text-xs font-medium text-gray-500 text-left border border-gray-300"
              [ngClass]="{'bg-blue-100': index === 4}"
              style="min-width: 80px"
            >
              {{verse.number}}
            </th>
            <th
              *ngFor="let empty of [].constructor(5 - chunk.length); let i = index"
              class="px-2 py-1 text-xs font-medium text-gray-500 text-left border border-gray-300"
              [ngClass]="{'bg-blue-100': (chunk.length + i === 4)}"
            ></th>
          </tr>
          </thead>
          <tbody>
          <tr>
            <td
              *ngFor="let verse of chunk; let index = index"
              class="px-2 py-2 text-sm text-gray-700 text-center border border-gray-300 whitespace-pre-wrap"
              [ngClass]="{'bg-blue-100': index === 4}"
              style="vertical-align: top"
            >
              <ng-container *ngFor="let line of verse.text.split('\n'); let lineIndex = index">
                <span *ngIf="lineIndex > 0"><br></span>
                {{line}}
              </ng-container>
            </td>
            <td
              *ngFor="let empty of [].constructor(5 - chunk.length); let i = index"
              class="px-2 py-2 border border-gray-300"
              [ngClass]="{'bg-blue-100': (chunk.length + i === 4)}"
            ></td>
          </tr>
          </tbody>
        </ng-container>
      </table>
    </div>
  </div>

  <div class="mt-8 text-sm text-gray-600">
    <h3 class="font-semibold mb-1">How it works:</h3>
    <ul class="list-disc list-inside space-y-1 ml-2">
      <li>Original text is reduced to just the first letter of each word</li>
      <li>The verse structure and numbers are preserved</li>
      <li>In the grid, each column represents a verse, with the verse number at the top</li>
      <li>This format makes it easier to practice memorization</li>
    </ul>
  </div>
</div>
